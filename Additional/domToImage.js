!function(e){"use strict";function n(e,n){return n=n||{},Promise.resolve(e).then(function(e){return o(e,n.filter,!0)}).then(i).then(u).then(function(e){return n.bgcolor&&(e.style.backgroundColor=n.bgcolor),e}).then(function(n){return c(n,e.scrollWidth,e.scrollHeight)})}function t(e,n){return a(e,n||{}).then(function(e){return e.toDataURL()})}function r(e,n){return a(e,n||{}).then(m.canvasToBlob)}function o(n,t,r){function i(e){return e instanceof HTMLCanvasElement?m.makeImage(e.toDataURL()):e.cloneNode(!1)}function u(e,n,t){function r(e,n,t){var r=Promise.resolve();return n.forEach(function(n){r=r.then(function(){return o(n,t)}).then(function(n){n&&e.appendChild(n)})}),r}var i=e.childNodes;return 0===i.length?Promise.resolve(n):r(n,m.asArray(i),t).then(function(){return n})}function c(n,t){function r(){function r(e,n){function t(e,n){m.asArray(e).forEach(function(t){n.setProperty(t,e.getPropertyValue(t),e.getPropertyPriority(t))})}e.cssText?n.cssText=e.cssText:t(e,n)}r(e.window.getComputedStyle(n),t.style)}function o(){function r(r){function o(n,t,r){function o(e){var n=e.getPropertyValue("content");return e.cssText+" content: "+n+";"}function i(e){function n(n){return n+": "+e.getPropertyValue(n)+(e.getPropertyPriority(n)?" !important":"")}return m.asArray(e).map(n).join("; ")+";"}var u="."+n+":"+t,c=r.cssText?o(r):i(r);return e.document.createTextNode(u+"{"+c+"}")}var i=e.window.getComputedStyle(n,r),u=i.getPropertyValue("content");if(""!==u&&"none"!==u){var c=m.uid();t.className=t.className+" "+c;var a=e.document.createElement("style");a.appendChild(o(c,r,i)),t.appendChild(a)}}[":before",":after"].forEach(function(e){r(e)})}function i(){n instanceof HTMLTextAreaElement&&(t.innerHTML=n.value),n instanceof HTMLInputElement&&t.setAttribute("value",n.value)}function u(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach(function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)}))}return t instanceof Element?Promise.resolve().then(r).then(o).then(i).then(u).then(function(){return t}):t}return r||!t||t(n)?Promise.resolve(n).then(i).then(function(e){return u(n,e,t)}).then(function(e){return c(n,e)}):Promise.resolve()}function i(e){return g.resolveAll().then(function(n){var t=document.createElement("style");return e.appendChild(t),t.appendChild(document.createTextNode(n)),e})}function u(e){return p.inlineAll(e).then(function(){return e})}function c(e,n,t){return Promise.resolve(e).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)}).then(m.escapeXhtml).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+n+'" height="'+t+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})}function a(e,t){function r(e){var n=document.createElement("canvas");return n.width=e.scrollWidth,n.height=e.scrollHeight,n}return n(e,t).then(m.makeImage).then(m.delay(100)).then(function(n){var t=r(e);return t.getContext("2d").drawImage(n,0,0),t})}function s(){function n(){var e="application/font-woff",n="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:n,jpeg:n,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(e){var n=/\.([^\.\/]*?)$/g.exec(e);return n?n[1]:""}function r(e){var r=t(e).toLowerCase();return n()[r]||""}function o(e){return-1!==e.search(/^(data:)/)}function i(e){return new Promise(function(n){for(var t=window.atob(e.toDataURL().split(",")[1]),r=t.length,o=new Uint8Array(r),i=0;r>i;i++)o[i]=t.charCodeAt(i);n(new Blob([o],{type:"image/png"}))})}function u(e){return e.toBlob?new Promise(function(n){e.toBlob(n)}):i(e)}function c(n,t){var r=e.document.implementation.createHTMLDocument(),o=r.createElement("base");r.head.appendChild(o);var i=r.createElement("a");return r.body.appendChild(i),o.href=t,i.href=n,i.href}function a(){var e=0;return function(){function n(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}return"u"+n()+e++}}function s(e){return new Promise(function(n,t){var r=new Image;r.onload=function(){n(r)},r.onerror=t,r.src=e})}function l(e){var n=3e4;return new Promise(function(t){function r(){if(4===u.readyState){if(200!==u.status)return void i("cannot fetch resource: "+e+", status: "+u.status);var n=new FileReader;n.onloadend=function(){var e=n.result.split(/,/)[1];t(e)},n.readAsDataURL(u.response)}}function o(){i("timeout of "+n+"ms occured while fetching resource: "+e)}function i(e){console.error(e),t("")}var u=new XMLHttpRequest;u.onreadystatechange=r,u.ontimeout=o,u.responseType="blob",u.timeout=n,u.open("GET",e,!0),u.send()})}function f(e,n){return"data:"+n+";base64,"+e}function h(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function m(e){return function(n){return new Promise(function(t){setTimeout(function(){t(n)},e)})}}function d(e){for(var n=[],t=e.length,r=0;t>r;r++)n.push(e[r]);return n}function g(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")}return{escape:h,parseExtension:t,mimeType:r,dataAsUrl:f,isDataUrl:o,canvasToBlob:u,resolveUrl:c,getAndEncode:l,uid:a(),delay:m,asArray:d,escapeXhtml:g,makeImage:s}}function l(){function e(e){return-1!==e.search(o)}function n(e){for(var n,t=[];null!==(n=o.exec(e));)t.push(n[1]);return t.filter(function(e){return!m.isDataUrl(e)})}function t(e,n,t,r){function o(e){return new RegExp("(url\\(['\"]?)("+m.escape(e)+")(['\"]?\\))","g")}return Promise.resolve(n).then(function(e){return t?m.resolveUrl(e,t):e}).then(r||m.getAndEncode).then(function(e){return m.dataAsUrl(e,m.mimeType(n))}).then(function(t){return e.replace(o(n),"$1"+t+"$3")})}function r(r,o,i){function u(){return!e(r)}return u()?Promise.resolve(r):Promise.resolve(r).then(n).then(function(e){var n=Promise.resolve(r);return e.forEach(function(e){n=n.then(function(n){return t(n,e,o,i)})}),n})}var o=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:r,shouldProcess:e,impl:{readUrls:n,inline:t}}}function f(){function e(){return n(document).then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})}function n(){function e(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return d.shouldProcess(e.style.getPropertyValue("src"))})}function n(e){var n=[];return e.forEach(function(e){try{m.asArray(e.cssRules||[]).forEach(n.push.bind(n))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),n}function t(e){return{resolve:function(){var n=(e.parentStyleSheet||{}).href;return d.inlineAll(e.cssText,n)},src:function(){return e.style.getPropertyValue("src")}}}return Promise.resolve(m.asArray(document.styleSheets)).then(n).then(e).then(function(e){return e.map(t)})}return{resolveAll:e,impl:{readAll:n}}}function h(){function e(e){function n(n){return m.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(n||m.getAndEncode).then(function(n){return m.dataAsUrl(n,m.mimeType(e.src))}).then(function(n){return new Promise(function(t,r){e.onload=t,e.onerror=r,e.src=n})})}return{inline:n}}function n(t){function r(e){var n=e.style.getPropertyValue("background");return n?d.inlineAll(n).then(function(n){e.style.setProperty("background",n,e.style.getPropertyPriority("background"))}).then(function(){return e}):Promise.resolve(e)}return t instanceof Element?r(t).then(function(){return t instanceof HTMLImageElement?e(t).inline():Promise.all(m.asArray(t.childNodes).map(function(e){return n(e)}))}):Promise.resolve(t)}return{inlineAll:n,impl:{newImage:e}}}var m=s(),d=l(),g=f(),p=h();e.domtoimage={toSvg:n,toPng:t,toBlob:r,impl:{fontFaces:g,images:p,util:m,inliner:d}}}(this);